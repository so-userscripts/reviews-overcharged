// ==UserScript==
// @name            Reviews Overcharged
// @author          Oleg Valter <oleg.a.valter@gmail.com>
// @description     Quality of life improvements for review queues
// @grant           unsafeWindow
// @homepage        https://github.com/userscripters/reviews-overcharged#readme
// @match           https://stackoverflow.com/review/suggested-edits/*
// @match           https://serverfault.com/review/suggested-edits/*
// @match           https://superuser.com/review/suggested-edits/*
// @match           https://*.stackexchange.com/review/suggested-edits/*
// @match           https://askubuntu.com/review/suggested-edits/*
// @match           https://stackapps.com/review/suggested-edits/*
// @match           https://mathoverflow.net/review/suggested-edits/*
// @match           https://pt.stackoverflow.com/review/suggested-edits/*
// @match           https://ja.stackoverflow.com/review/suggested-edits/*
// @match           https://ru.stackoverflow.com/review/suggested-edits/*
// @match           https://es.stackoverflow.com/review/suggested-edits/*
// @match           https://meta.stackoverflow.com/review/suggested-edits/*
// @match           https://meta.serverfault.com/review/suggested-edits/*
// @match           https://meta.superuser.com/review/suggested-edits/*
// @match           https://meta.askubuntu.com/review/suggested-edits/*
// @match           https://meta.mathoverflow.net/review/suggested-edits/*
// @match           https://pt.meta.stackoverflow.com/review/suggested-edits/*
// @match           https://ja.meta.stackoverflow.com/review/suggested-edits/*
// @match           https://ru.meta.stackoverflow.com/review/suggested-edits/*
// @match           https://es.meta.stackoverflow.com/review/suggested-edits/*
// @run-at          document-start
// @source          git+https://github.com/userscripters/reviews-overcharged.git
// @supportURL      https://github.com/userscripters/reviews-overcharged/issues
// @version         2.0.2
// ==/UserScript==

!function r(i,n,a){function o(t,e){if(!n[t]){if(!i[t]){var s="function"==typeof require&&require;if(!e&&s)return s(t,!0);if(c)return c(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}s=n[t]={exports:{}},i[t][0].call(s.exports,function(e){return o(i[t][1][e]||e)},s,s.exports,r,i,n,a)}return n[t].exports}for(var c="function"==typeof require&&require,e=0;e<a.length;e++)o(a[e]);return o}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.selectActions=void 0;r.selectActions=({selectors:e})=>[...document.querySelectorAll(e.title.actions)]},{}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getSuggestionsUserStats=r.getSuggestionsByPost=r.getSuggestionInfo=void 0;const o=e("./config"),a=e("./utils");r.getSuggestionInfo=async(e,t={})=>{var{site:t=o.DEF_SITE}=t;const r=new URL(`${o.API_BASE}/${o.API_VER}/suggested-edits/`+e),s=(r.search=new URLSearchParams({key:o.API_KEY,site:t}).toString(),await fetch(r.toString()));if(s.ok)return{items:e}=await s.json(),e[0]},r.getSuggestionsByPost=async(e,t={})=>{var{site:t=o.DEF_SITE,type:r="all"}=t;const s=new URL(`${o.API_BASE}/${o.API_VER}/posts/${e}/suggested-edits`),i=(s.search=new URLSearchParams({key:o.API_KEY,site:t}).toString(),await fetch(s.toString()));if(!i.ok)return[];const n=(await i.json())["items"];e={approved:({approval_date:e})=>!!e,rejected:({rejection_date:e})=>!!e,pending:({approval_date:e,rejection_date:t})=>!e&&!t}[r];return e?n.filter(e):n};r.getSuggestionsUserStats=async(e,t,r={})=>{const s=new URL(`${o.API_BASE}/${o.API_VER}/users/${t}/suggested-edits`),i={key:o.API_KEY,site:r.site||o.DEF_SITE};Object.keys(r).length&&({from:t,to:r=new Date}=r,t&&(i.from=(0,a.toApiDate)(t)),r&&(i.to=(0,a.toApiDate)(r))),s.search=new URLSearchParams(i).toString();const n=await fetch(s.toString());if(!n.ok)return[];t=(await n.json()).items;return t}},{"./config":5,"./utils":20}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addAuditNotification=void 0;r.addAuditNotification=e=>{var e=e["selectors"]["content"],t="audit_notification";if(document.getElementById(t))return!0;const r=document.querySelector(e.typeHint),s=document.querySelector(e.postSummary);if(!r)return!1;const i=document.createElement("blockquote");return i.id=t,i.classList.add("mb12","fs-headline1"),i.textContent="This is an Audit. Tread carefully",r.after(i),r.remove(),null!==s&&void 0!==s&&s.remove(),!0}},{}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.removeExistingSidebars=void 0;const i=e("./utils");r.removeExistingSidebars=e=>{e=e.ids.sidebar.extra;const t=[...document.querySelectorAll(`[id^=${e}]`)];if(t.length<=1)return!0;const r=(0,i.getReviewId)(),s=t.filter(({id:e})=>!e.includes(r));return s.forEach(e=>e.remove()),!0}},{"./utils":20}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.config=r.API_KEY=r.API_VER=r.DEF_SITE=r.API_BASE=void 0;const s=e("./utils");r.API_BASE="https://api.stackexchange.com",r.DEF_SITE="stackoverflow",r.API_VER=2.2,r.API_KEY="7LRwV6M6y9lsj4OFtBej3A((",r.config={script:{name:"Review Overcharged"},page:{suggestionId:(0,s.last)(location.pathname.split("/"))},classes:{grid:{container:"grid",cell:"grid--cell"},visibility:{none:"v-hidden"}},ids:{progress:{span:"progress-ratio"},sidebar:{extra:"extra-info"}},filters:{unsafe:")7tZ5Od"},selectors:{actions:{action:".js-action-radio-parent",disabled:".is-disabled",wrapper:".js-review-actions",sidebar:".js-actions-sidebar",modal:{form:"form[action='/suggested-edits/reject']",votes:{labels:"label[for^=rejection-reason].s-label",counts:".s-badge__votes"}},inputs:{reject:"#review-action-Reject"}},buttons:{submit:".js-review-submit",skip:".js-review-actions:not(.d-none) .js-action-button[value=1]",close:".s-modal--close"},reviews:{done:".js-reviews-done",daily:".js-reviews-per-day"},diffs:{deleted:".full-diff .deleted > div",added:".full-diff .inserted > div"},page:{links:{excerpt:"a.question-hyperlink[href*='/tags']",question:"a[href*='/questions/']",answer:"a.answer-hyperlink"}},content:{typeHint:".js-review-content .fs-title",postSummary:".s-post-summary"},title:{description:".s-page-title--description",actions:".s-page-title--actions a",learnMore:".js-show-modal-from-nav.s-link",title:".s-page-title--text",header:".s-page-title--header"},info:{post:{wrapper:".postcell span"},editor:{card:"a.s-user-card--link"}}}}},{"./utils":20}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.decolorDiff=void 0;r.decolorDiff=e=>{var{added:e,deleted:t}=e.selectors.diffs;const r=document.querySelector(e),s=document.querySelector(t);return!(!r||!s)&&(r.style.backgroundColor="unset",s.style.backgroundColor="unset",!0)}},{}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createItem=r.createGridCell=void 0;const s=e("./config");r.createGridCell=({classes:e})=>{const t=document.createElement("div");return t.classList.add(e.grid.cell),t};r.createItem=(...e)=>{const t=document.createElement("div");return t.classList.add(s.config.classes.grid.cell,"p12"),t.append(...e),t}},{"./config":5}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.waitForSelector=r.goParentUp=r.arraySelect=void 0;r.arraySelect=(e,t)=>[...e.querySelectorAll(t)],r.goParentUp=(e,t=1)=>0!==t&&e?(0,r.goParentUp)(e.parentElement,t-1):e;r.waitForSelector=(i,n)=>{var e=document.querySelectorAll(i);return e.length?Promise.resolve(e):new Promise((t,e)=>{const r=n&&setTimeout(e,n),s=new MutationObserver(()=>{var e=document.querySelectorAll(i);e.length&&(clearTimeout(r),s.disconnect(),t(e))});s.observe(document,{subtree:!0,childList:!0,attributes:!0})})}},{}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getSuggestionTotals=r.getEditAuthorId=r.getPostId=r.getEditType=r.getTagName=r.getQuestionId=r.getAnswerId=void 0;const i=e("./config"),s=e("./domUtils"),n=e("./utils");r.getAnswerId=async e=>{var[e]=await(0,s.waitForSelector)(e,1e4);return(0,n.safeMatch)((null==e?void 0:e.href)||"",/\/questions\/\d+\/[\w-]+\/(\d+)/)[0]},r.getQuestionId=async e=>{var[e]=await(0,s.waitForSelector)(e,1e4);return(0,n.safeMatch)((null==e?void 0:e.href)||"",/\/questions\/(\d+)/)[0]},r.getTagName=async e=>{var[e]=await(0,s.waitForSelector)(e,1e3);return(0,n.safeMatch)((null==e?void 0:e.href)||"",/\/tags\/(.+)\/info/)[0]},r.getEditType=async({selectors:e})=>{var[{textContent:e}]=await(0,s.waitForSelector)(e.content.typeHint,1e4);return(0,n.safeMatch)(e||"",/(question|answer)\s+edit/)[0]},r.getPostId=async e=>{var{links:e}=e["selectors"]["page"];return"question"===await(0,r.getEditType)(i.config)?(0,r.getQuestionId)(e.question):(0,r.getAnswerId)(e.answer)},r.getEditAuthorId=()=>{var e=i.config.selectors.info.post.wrapper,t=document.querySelectorAll(e);if(!t.length)return(0,n.handleMatchFailure)(e,null);e=Array.from(t).find(({textContent:e})=>/proposed/i.test(e||""));if(!e)return null;t=i.config.selectors.info.editor.card;const r=e["parentElement"];e=r.querySelector(t);if(!e)return(0,n.handleMatchFailure)(t,null);const s=e["href"];var[,t]=s.match(/users\/(\d+)/)||[];return t||null};r.getSuggestionTotals=e=>{const r={get ratio(){var{approved:e,pending:t,rejected:r,total:s}=this;return{ofApproved:e/s,ofRejected:r/s,ofPending:t/s,approvedToRejected:e/(0===r?1:r)}},get pending(){var{approved:e,rejected:t,total:r}=this;return r-(e+t)},approved:0,rejected:0,total:0};return e.forEach(({approval_date:e,rejection_date:t})=>{r.total+=1,e&&(r.approved+=1),t&&(r.rejected+=1)}),r}},{"./config":5,"./domUtils":8,"./utils":20}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LineGraph=r.GraphGrid=r.GraphAxis=r.Serie=r.GraphLine=r.Point=void 0;const m="http://www.w3.org/2000/svg";class Point{constructor(e,t,r=1){this.x=e,this.y=t,this.size=r,this.colour="black",this.type="circle"}get middle(){var e=this["size"];return e/2}move(e,t){this.x+=e,this.y+=t,this.sync()}create(){const{colour:e,type:t}=this,r={circle:()=>document.createElementNS(m,t),rectangle:()=>document.createElementNS(m,"rect")};var s=r[t]();const i=s["style"];return i.fill=e,this.element=s,this.sync(),s}draw(){var{element:e=this.create()}=this;return e}sync(){const{element:e,x:t,y:r,middle:s,size:i,type:n}=this;if(e){const o={circle:()=>(e.setAttribute("cx",t.toString()),e.setAttribute("cy",r.toString()),e.setAttribute("r",s.toString()),e),rectangle:()=>(e.setAttribute("x",(t-s).toString()),e.setAttribute("y",(r-s).toString()),e.setAttribute("width",i.toString()),e.setAttribute("height",i.toString()),e)};return o[n]()}}}r.Point=Point;class GraphLine{constructor(e,t,r=1){this.start=e,this.end=t,this.stroke=r,this.colour="black",this.type="straight"}create(){const{colour:e,stroke:t}=this;var r=document.createElementNS(m,"line");const s=r["style"];return s.strokeWidth=t.toString(),s.stroke=e,this.element=r,this.sync(),r}draw(){var{element:e=this.create()}=this;return e}resize(){const{start:e,end:t}=this;e.sync(),t.sync(),this.sync()}sync(){const{start:{x:e,y:t},end:{x:r,y:s},element:i}=this;i&&(i.setAttribute("x1",e.toString()),i.setAttribute("y1",t.toString()),i.setAttribute("x2",r.toString()),i.setAttribute("y2",s.toString()))}}r.GraphLine=GraphLine;class List{constructor(){this.items=[]}push(e){const t=this["items"];return t.push(...e()),t}pop(e){const t=this["items"];return t.splice(t.length-e,e)}}class Serie extends List{constructor(e,t){var{curved:t=!1,size:r,colour:s,points:i}=t;super(),this.graph=e,this.curved=!1,this.colour="black",this.size=1,this.lines=[],this.curved=t,r&&(this.size=r),s&&(this.colour=s),i&&this.pushPoints(...i)}get numLines(){var e=this["lines"];return e.length}get numPoints(){var e=this["items"];return e.length}pushPoints(...e){const{colour:o,graph:t}=this,a=t["height"];return this.push(()=>e.map(({x:e,y:t,size:r=1,colour:s,type:i})=>{const n=new Point(e,a-t,r);return n.colour=s||o,i&&(n.type=i),n}))}create(){const{items:s,size:i,colour:n,curved:o}=this,a=o?"curved":"straight";var e=s.map((e,t)=>{t=s[t+1];const r=new GraphLine(e,t||e,i);return n&&(r.colour=n),o&&(r.type,a),r});return this.lines=e}draw(){const e=this["items"],t=this.create();var r=e.map(e=>e.draw());return[...t.map(e=>e.draw()),...r]}resize(e){const{lines:t,size:r,items:s}=this,i=e/r;s.forEach(e=>{e.x*=i,e.y*=i}),t.forEach(e=>e.resize()),this.size=e}}r.Serie=Serie;class GraphAxis{constructor({makeX:e=!0,makeY:t=!0,size:r=1,colour:s="black"}){this.makeX=!0,this.makeY=!0,this.size=1,this.colour="black",this.makeX=e,this.makeY=t,this.size=r,this.colour=s}get numXmarks(){var{graph:e,makeX:t,size:r}=this;if(!e||!t)return 0;t=e.width;return Math.ceil(t/r)-2}get numYmarks(){var{graph:e,makeX:t,size:r}=this;if(!e||!t)return 0;t=e.height;return Math.ceil(t/r)-2}createPointer(e,t,r="auto"){var s=this["colour"];const i=document.createElementNS(m,"marker"),n=(i.setAttribute("refX",e.toString()),i.setAttribute("refY",t.toString()),i.setAttribute("orient",r.toString()),i)["style"];return n.color=s,i}createMark(){}createMarks(e){var{graph:t,numXmarks:r,numYmarks:s}=this;if(t){for(let e=1;e<=r;e++);for(let e=1;e<=s;e++);}}createAxis(e,t,r,s){const i=document.createElementNS(m,"line");return i.setAttribute("x1",e.toString()),i.setAttribute("x2",r.toString()),i.setAttribute("y1",t.toString()),i.setAttribute("y2",s.toString()),i}create(){var{makeX:e,makeY:t,size:r,graph:s,element:i,colour:n}=this;this.createMarks(r);const o=i||document.createElementNS(m,"g"),a=o["style"];if(a.stroke=n,!s)return o;var{width:r,height:i}=s;return e&&o.append(this.createAxis(0,i,r,i)),t&&o.append(this.createAxis(0,i,r,0)),o}draw(){var{element:e=this.create()}=this;return this.element=e}sync(){}}r.GraphAxis=GraphAxis;class GraphGrid{constructor(e,t,r,s=1){this.graph=e,this.width=t,this.height=r,this.size=s,this.horizontal=!0,this.vertical=!0,this.colour="black",this.xLines=[],this.yLines=[]}get numXcells(){var{size:e,width:t}=this;return Math.ceil(t/e)}get numYcells(){var{size:e,height:t}=this;return Math.ceil(t/e)}createLines({type:e,size:t,colour:r,lines:s,end:i,start:n=0}){const o=document.createElementNS(m,"line"),a=o["style"];a.stroke=r;var r="horizontal"===e,c=r?"x1":"y1",l=r?"y1":"x1",d=r?"x2":"y2",u=r?"y2":"x2";const h=[];for(let e=0;e<s;e++){var g=(t*e).toString();const p=o.cloneNode();p.setAttribute(c,g),p.setAttribute(d,g),p.setAttribute(l,n.toString()),p.setAttribute(u,i.toString()),h.push(p)}return h}create(){const{colour:e,numXcells:t,numYcells:r,size:s,graph:i,xLines:n,yLines:o,horizontal:a,vertical:c}=this;var l,d,u;i&&({height:l,width:d}=i,u={colour:e,size:s},a&&n.push(...this.createLines({...u,type:"horizontal",end:l,lines:t})),c&&o.push(...this.createLines({...u,type:"vertical",end:d,lines:r})))}draw(){var{xLines:e,yLines:t,graph:r}=this;if(r&&r.element){e.length||t.length||this.create();const s=r["element"];s.prepend(...e,...t)}}sync(){const{xLines:e,yLines:t}=this;return e.forEach(e=>e.remove()),t.forEach(e=>e.remove()),e.length=0,t.length=0,this.draw()}}r.GraphGrid=GraphGrid;r.LineGraph=class extends List{constructor({id:e,width:t,height:r,size:s=1,axisColour:i="black",gridColour:n="lightgrey",gridSize:o=2,xAxisGridLines:a=!0,yAxisGridLines:c=!0}){super(),this.id=e,this.size=s,this.width=t,this.height=r;const l=new GraphGrid(this,t,r,o);l.colour=n,l.horizontal=a,l.vertical=c,this.grid=l,this.axis=new GraphAxis({size:s,colour:i})}pushSeries(...e){const s=this["size"];return this.push(()=>e.map(({points:e=[],...t})=>{const r=new Serie(this,{size:s,...t});return r.pushPoints(...e),r}))}clean(){var e,t=this["element"];if(t)for(;t.firstChild;)null!=(e=t.lastChild)&&e.remove()}create(){const{width:e,height:t,id:r}=this,s=document.createElementNS(m,"svg");return s.setAttribute("width",e.toString()),s.setAttribute("height",t.toString()),s.setAttribute("id",r),this.element=s}draw(){const{grid:e,axis:t,items:r,element:s=this.create()}=this;this.clean();var i=t.draw(),i=(s.append(i),e.draw(),r.flatMap(e=>e.draw()));return s.append(...i),s}resize(t){const e=this["items"];e.forEach(e=>e.resize(t)),this.size=t}sync(){const e=this["grid"];e.sync()}}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isTagEdit=void 0;const s=e("./getters");r.isTagEdit=async e=>{try{return!!await(0,s.getTagName)(e.selectors.page.links.excerpt)}catch(e){return!1}}},{"./getters":9}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const u=e("./api"),h=e("./audits"),g=e("./cleanup"),p=e("./config"),m=e("./diffs"),f=e("./guards"),v=e("./progress"),y=e("./reports"),S=e("./stats"),w=e("./title");window.addEventListener("load",async()=>{let r=!1,s;$(document).ajaxComplete((e,t)=>{t=t.responseJSON;"object"==typeof t&&t&&(s=t.suggestedEditId,r=t.isAudit)});const t="ReviewOvercharged";const i=new class{constructor(e){this.handlers=e}get names(){var e=this["handlers"];return Object.keys(e)}get actors(){var e=this["handlers"];return Object.values(e)}runAll(t){const e=this["actors"];return Promise.all(e.map(e=>e(t)))}}({moveProgressToTabs:v.moveProgressToTabs,optimizePageTitle:w.optimizePageTitle,decolorDiff:m.decolorDiff});var e=await(0,f.isTagEdit)(p.config),n=e||!s?void 0:await(0,u.getSuggestionInfo)(s);if(console.debug(`[${t}] suggested edit id: `+s),!n&&!e){const a=await i.runAll(p.config);return(0,y.reportHandlersStatus)(t,i.names,a),void(r&&(0,h.addAuditNotification)(p.config))}Object.assign(i.handlers,{addStatsSidebar:S.addStatsSidebar});const o=[g.removeExistingSidebars],a=await i.runAll(p.config),{actions:{wrapper:c}}=((0,y.reportHandlersStatus)(t,i.names,a),await(0,S.addMyStatsSidebar)(p.config),p.config)["selectors"],l=[Node.TEXT_NODE,Node.COMMENT_NODE],d=new MutationObserver(async e=>{e.find(({addedNodes:e})=>[...e].some(t=>l.every(e=>e!==t.nodeType)&&t.matches(c)))&&(e=await i.runAll(p.config),(0,y.reportHandlersStatus)(t,i.names,e),r&&(0,h.addAuditNotification)(p.config),await Promise.all(o.map(e=>e(p.config))))});d.observe(document,{subtree:!0,childList:!0})})},{"./api":2,"./audits":3,"./cleanup":4,"./config":5,"./diffs":6,"./guards":11,"./progress":13,"./reports":15,"./stats":16,"./title":18}],13:[function(e,t,l){"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.moveProgressToTabs=l.hideProgressBar=void 0;const d=e("./actions"),s=e("./domUtils"),u=e("./utils");l.hideProgressBar=({classes:{visibility:e}},t)=>{const r=(0,s.goParentUp)(t,3);return!!r&&(r.classList.add(e.none),!0)};l.moveProgressToTabs=e=>{var{ids:{progress:{span:t}},selectors:{reviews:r}}=e;const s=(0,d.selectActions)(e);var i=s.find(({href:e})=>/\/review\/suggested-edits/.test(e)),n=document.querySelector(r.daily),r=document.querySelector(r.done);if(!n||!r)return!1;var o=+(0,u.trimNumericString)(n.textContent||"0"),r=+(0,u.trimNumericString)(r.textContent||"0"),a=r/o,a=(0,u.toPercent)(a);if(!i)return!1;const c=i["style"];c.background=`linear-gradient(90deg, var(--theme-primary-color) ${a}, var(--black-075) ${a})`,c.color="var(--black-600)";a=document.getElementById(t)||(({ids:{progress:e}},t)=>{const r=document.createElement("span");return r.id=e.span,t.append(r),r})(e,i);return a.innerHTML=`&nbsp;(${r}/${o})`,(0,l.hideProgressBar)(e,n)}},{"./actions":1,"./domUtils":8,"./utils":20}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getRejectionCount=void 0;const l=e("./domUtils"),d=e("./utils");r.getRejectionCount=async e=>{var{modal:t}=e["selectors"]["actions"],e=await(async e=>{var{buttons:e,actions:{inputs:t,modal:r,action:s,disabled:i}}=e["selectors"];const n=document.querySelector(t.reject),o=document.querySelector(e.submit);if(!n||!o)return null;await(0,l.waitForSelector)(s+`:not(${i})`),n.click(),o.click();const a=[...await(0,l.waitForSelector)(r.form)][0];if(!a)return(0,d.handleMatchFailure)(r.form,null);t=a.cloneNode(!0);const c=a.querySelector(e.close);return c.click(),t})(e);if(!e)return(0,d.handleMatchFailure)(t.form,null);const r=(0,l.arraySelect)(e,t.votes.labels),s={vandalism:0,improvement:0,intent:0,reply:0,harm:0,guidance:0,copyright:0,circular:0},i={102:"improvement",101:"vandalism",104:"intent",105:"reply",106:"copyright",107:"guidance",110:"circular",0:"harm"},n=t.votes.counts;return r.forEach(e=>{const t=e["htmlFor"];var[,r]=t.match(/(\d+$)/)||[],r=i[r];e.querySelector(n)&&(s[r]+=1)}),s}},{"./domUtils":8,"./utils":20}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.reportHandlersStatus=void 0;r.reportHandlersStatus=(e,s,t)=>{t=t.reduce((e,t,r)=>`${e}
${s[r]} - `+(t?"success":"failure"),`[${e}] handler run:`);console.debug(t)}},{}],16:[function(e,t,f){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.addMyStatsSidebar=f.getDailyReviewerStats=f.addStatsSidebar=f.createRejectionCountItem=f.createEditorStatsItem=f.createEditAuthorItem=void 0;const c=e("./api"),v=e("./config"),h=e("./dom"),g=e("./getters"),y=e("./graphs"),l=e("./rejections"),p=e("./templaters"),d=e("./users"),m=e("./utils");f.createEditAuthorItem=({display_name:e,reputation:t,link:r})=>{const s=(0,p.p)("Name: ");return s.append((0,p.a)(r,e)),(0,h.createItem)((0,p.ul)({header:"Edit Author",items:[s,"Reputation: "+t]}))},f.createEditorStatsItem=({link:e},t)=>{const{approved:r,pending:s,rejected:i,total:n,ratio:{approvedToRejected:o,ofApproved:a,ofPending:c,ofRejected:l}}=(0,g.getSuggestionTotals)(t),d={header:"Author Stats",items:[]};if(n)return d.items.push(`Approved: ${r} (${(0,m.toPercent)(a,2)})`,`Rejected: ${i} (${(0,m.toPercent)(l,2)})`,`Pending: ${s} (${(0,m.toPercent)(c,2)})`,"Of total: "+n,"Ratio: "+o.toFixed(1)),(0,h.createItem)((0,p.ul)(d));{const u=(0,p.p)("Tag wiki/excerpt edits are not returned.");return u.append((0,p.br)(),(0,p.text)("See their "),(0,p.a)(e+"?tab=activity&sort=suggestions","activity tab")),d.items.push(u),(0,h.createItem)((0,p.ul)(d))}},f.createRejectionCountItem=e=>{const t=Object.entries(e).filter(([,e])=>!!e),r=t.map(([e,t])=>(0,m.scase)(e)+": "+t);return r.length||r.push("No reject votes"),(0,h.createItem)((0,p.ul)({items:r,header:"Reject votes"}))};f.addStatsSidebar=async e=>{const t=document.querySelector(e.selectors.actions.sidebar);if(!t)return!1;const r=document.createElement("div"),s=(r.classList.add("s-sidebarwidget","ps-sticky","t64","ml24","mt24","ws3"),r.id=e.ids.sidebar.extra+"-"+(0,m.getReviewId)(),document.createElement("div")),i=(s.classList.add("s-sidebarwidget--header"),s.textContent="Extra Info",document.createElement("div"));i.classList.add(e.classes.grid.container,"fd-column");var n=(0,g.getEditAuthorId)(),o=await(0,l.getRejectionCount)(e);if(!o)return!1;const a=[];return n&&([e,n]=await Promise.all([(0,d.getUserInfo)(e,n),(0,c.getSuggestionsUserStats)(e,n)]),e&&a.push((0,f.createEditAuthorItem)(e),(0,f.createEditorStatsItem)(e,n))),a.push((0,f.createRejectionCountItem)(o)),i.append(...a),r.append(s,i),t.append(r),!0};const S=["approve","edit","reject","reject and edit","skip"];f.getDailyReviewerStats=async(l,d,e={})=>{const{pageNum:t=1,maxPage:r=10}=e,u=new Map;if(t>=r)return console.debug(`[${l}] reached max page (${r}) for daily stats`),u;var s=new URL(location.origin+"/review/suggested-edits/history");const i=s["searchParams"],n=(i.set("userid",d.toString()),i.set("skipped","true"),i.set("page",t.toString()),await fetch(s,{credentials:"include"}));if(!n.ok)return console.debug(`[${l}] failed to get: `+s),u;const o=$(await n.text()),a=o.find("#content table > tbody > tr");if(!a.length)return u;a.each((e,t)=>{var t=t["cells"];const[r,,s,i]=t;var n,t=null==(t=s.textContent)?void 0:t.trim().toLowerCase(),o=null==(o=i.querySelector("span"))?void 0:o.title.slice(0,10),a=Number(null==(a=r.querySelector("a"))?void 0:a.href.replace(/.*?users\/(\d+)\/.*/,"$1"));if(t&&o&&a)if(n=t,S.some(e=>e===n))if(a!==d)console.debug(`[${l}] skipping non-matching uid: `+a);else{u.has(o)||u.set(o,{approve:0,edit:0,reject:0,"reject and edit":0,skip:0});const c=u.get(o);c?c[t]+=1:console.debug(`[${l}] missing daily stat for `+o)}else console.debug(`[${l}] not a review action: `+t);else console.debug(`[${l}] malformed review row: ${o} ${t} `+a)}),await(0,m.delay)(2010);const c=await(0,f.getDailyReviewerStats)(l,d,{...e,pageNum:t+1});return c.forEach((e,t)=>{const r=u.get(t);if(r)return r.approve+=e.approve,r.reject+=e.reject,void(r.skip+=e.skip);u.set(t,e)}),u};f.addMyStatsSidebar=async e=>{const t=document.querySelector(v.config.selectors.actions.sidebar);if(!t)return!1;const r=document.createElement("div"),s=(r.classList.add("s-sidebarwidget","ps-sticky","t64","ml24","mt24","ws3"),r.id=v.config.ids.sidebar.extra+"-my-stats",document.createElement("div")),i=(s.classList.add("s-sidebarwidget--header"),s.textContent="My Stats",document.createElement("div")),n=(i.classList.add("grid","fd-column"),document.createElement("div"));n.classList.add("grid--cell","p12"),i.append(n),r.append(s,i);const o=new y.LineGraph({id:"reviewer-daily-stats",height:80,width:290,gridColour:"var(--black-600)",gridSize:10,xAxisGridLines:!1});n.append(o.draw()),t.append(r);var a={curved:!0};const[c,l,d,u,h]=o.pushSeries({...a,colour:"var(--green-500)"},{...a,colour:"var(--gold)"},{...a,colour:"var(--red-500)"},{...a,colour:"var(--orange-500)"},{...a,colour:"var(--blue-600)"});a=StackExchange.options.user.userId;if(a){const g=await(0,f.getDailyReviewerStats)(e.script.name,a),p={size:5,type:"circle"},m=Math.floor(1024/g.size);g.forEach(e=>{var{approve:e,edit:t,reject:r,skip:s,"reject and edit":i}=e;c.pushPoints({...p,x:c.numPoints*m,y:10*e}),l.pushPoints({...p,x:l.numPoints*m,y:10*t}),d.pushPoints({...p,x:d.numPoints*m,y:10*r}),u.pushPoints({...p,x:u.numPoints*m,y:10*i}),h.pushPoints({...p,x:h.numPoints*m,y:10*s})}),o.draw()}return!0}},{"./api":2,"./config":5,"./dom":7,"./getters":9,"./graphs":10,"./rejections":14,"./templaters":17,"./users":19,"./utils":20}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ul=n.text=n.p=n.li=n.br=n.a=void 0;n.a=(e,t=e)=>{const r=document.createElement("a");return r.href=e,r.textContent=t,r.target="_blank",r.referrerPolicy="no-referrer",r},n.br=()=>document.createElement("br"),n.li=e=>{const t=document.createElement("li");return"string"==typeof e?t.textContent=e:t.append(e),t},n.p=e=>{const t=document.createElement("p");return t.style.marginBottom="0",t.innerText=e,t},n.text=e=>document.createTextNode(e);n.ul=({header:e,items:t})=>{const r=document.createElement("ul"),s=r["style"];if(s.listStyle="none",s.margin="0",e){const i=document.createElement("h3");i.classList.add("mb8"),i.textContent=e,r.append(i)}e=t.map(n.li);return r.append(...e),r}},{}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.optimizePageTitle=n.removeTitleLines=void 0;const o=e("./dom"),a=e("./utils");n.removeTitleLines=(e,t)=>(t||document).querySelectorAll(e.selectors.title.description).forEach(e=>e.remove());n.optimizePageTitle=e=>{var t=e.selectors.title.title;const r=document.querySelector(t);if(!r)return(0,a.handleMatchFailure)(t,!1);r.classList.add(e.classes.grid.container);t=document.querySelector(e.selectors.title.header);const s=(0,o.createGridCell)(e);s.classList.add("ml12"),t&&s.append(t);t=r.querySelector(e.selectors.title.learnMore);const i=s.cloneNode();return t&&i.append(t),(0,n.removeTitleLines)(e,r),r.append(s,i),!0}},{"./dom":7,"./utils":20}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getUserInfo=void 0;const n=e("./config");r.getUserInfo=async({filters:{unsafe:e}},t,r=n.DEF_SITE)=>{const s=new URL(`${n.API_BASE}/${n.API_VER}/users/`+t),i=(s.search=new URLSearchParams({filter:e,key:n.API_KEY,site:r}).toString(),await fetch(s.toString()));if(!i.ok)return null;var[t]=(await i.json())["items"];return t}},{"./config":5}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.delay=r.getReviewId=r.trimNumericString=r.toPercent=r.toApiDate=r.scase=r.safeMatch=r.last=r.handleMatchFailure=void 0;r.handleMatchFailure=(e,t)=>(console.debug("Couldn't find the element with selector: "+e),t),r.last=e=>e[e.length-1],r.safeMatch=(e,t,r="")=>(e.match(t)||[e,r]).slice(1),r.scase=e=>e[0].toUpperCase()+e.slice(1).toLowerCase(),r.toApiDate=e=>(e.valueOf()/1e3).toString(),r.toPercent=(e,t=0)=>{const r=100*e;return r.toFixed(r!==Math.trunc(r)?t:0)+"%"},r.trimNumericString=e=>e.replace(/\D/g,""),r.getReviewId=()=>(0,r.last)(location.href.split("/"));r.delay=(t=100)=>new Promise(e=>{setTimeout(e,t)})},{}]},{},[12]);